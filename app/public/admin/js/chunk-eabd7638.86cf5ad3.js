(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eabd7638"],{3982:function(t,e,a){"use strict";var i=a("dbb8"),n=a.n(i);n.a},dbb8:function(t,e,a){},f917:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page vote-stat-page"},[a("div",{staticClass:"page-content"},[a("div",{staticClass:"page-tools"},[a("h3",[t._v(t._s(t.actTitle)),a("span",{directives:[{name:"show",rawName:"v-show",value:t.playerInfo,expression:"playerInfo"}]},[t._v(t._s(t.playerInfo))]),t._v("投票统计")]),a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-refresh"},on:{click:function(e){return t.queryData()}}},[t._v("刷新")]),a("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-back"},on:{click:function(e){return t.doBack()}}},[t._v("返回")])],1),a("div",{ref:"container",staticClass:"container",style:{height:t.winHeight-160+"px"}})])])},n=[],o=(a("fb37"),a("f763"),a("7a59"),a("b745"),a("7364"),a("3604")),r=a("46f1"),c=a("f1ed"),s={name:"VoteStat",computed:{winHeight:function(){return this.$store.state.winHeight}},data:function(){return{actTitle:"",actId:"",playerId:"",container:null,chart:null,titles:[],datas:[],voteStartTime:null,playerInfo:""}},created:function(){var t=this,e=t.$store;e.commit("switchActiveMenu","acts"),e.commit("setRoutePath",[{label:"投票记录",name:"votes"},{label:"投票统计",name:"voteStat"}]),e.commit("switchLoading",!1)},mounted:function(){var t=this;t.$nextTick(function(){t.container=t.$refs.container,t.init()})},methods:{init:function(){var t=this,e=t.$route,a=e.query;t.actId=a.id||"",t.playerId=a.pId||"",t.actId?t.queryActDetail():t.queryData(),t.playerId&&t.queryPlayerDetail()},queryPlayerDetail:function(){var t=this;t.$ajax({url:r["a"].getPlayer+t.playerId}).then(function(e){if(200==e.code){var a=e.data;t.playerInfo="".concat(a.no,'号选手"').concat(a.name,'"')}})},queryActDetail:function(){var t=this;t.$ajax({url:r["a"].getActivity+t.actId}).then(function(e){if(200==e.code){var a=e.data;t.actTitle=a.title;var i=new Date(a.voteStartTime);i.getTime()<+new Date&&(t.voteStartTime=i,t.queryData())}else t.$router.back()})},queryData:function(){var t=this,e=864e5;t.$ajax({url:r["a"].getVoteDateStat,method:"post",data:{actId:t.actId||"",playerId:t.playerId||""}}).then(function(a){if(200==a.code){var i=a.data||[];i.sort(function(t,e){return t.days>e.days?1:-1});var n={},o={},r={},s={},l=t.voteStartTime?new Date(t.voteStartTime):new Date;if(i.length&&i[0].days<Object(c["d"])(l,"yyyyMMdd")){var d=i[0].days;l.setDate(d.slice(6,8)),l.setMonth(d.slice(4,6)-1),l.setFullYear(d.slice(0,4))}var u=new Date;u.setHours(23,59,59,0);var y="";while(l.getTime()<=u.getTime())y=Object(c["d"])(l,"yyyyMMdd"),n[y]=0,o[y]=0,r[y]=0,s[y]=0,l.setTime(l.getTime()+e);i.forEach(function(t){t.voteNum=t.voteNum-0,"0"==t.type?n[t.days]=t.voteNum||0:"1"==t.type?o[t.days]=t.voteNum||0:"2"==t.type&&(r[t.days]=t.voteNum||0),s[t.days]=(s[t.days]||0)+t.voteNum});var h=[[],[],[],[]],m=[];Object.keys(n).forEach(function(t){m.push(Object(c["c"])(t,".")),h[0].push(n[t]),h[1].push(o[t]),h[2].push(r[t]),h[3].push(s[t])}),t.chart?t.refreshChart(m,h):t.createChart(m,h)}})},refreshChart:function(t,e){var a=this,i=a.chart,n=i.getOption(),o=n.series,r=n.xAxis;o[0].data=e[0],o[1].data=e[1],o[2].data=e[2],o[3].data=e[3],r[0].data=t,i.setOption({series:o,xAxis:r})},createChart:function(t,e){var a=this,i={grid:{top:50,left:30,right:40,bottom:20,containLabel:!0},tooltip:{trigger:"axis"},legend:{orient:"horizontal",x:"center",y:15,borderColor:"#ccc",padding:5,itemGap:10,itemWidth:20,itemHeight:14,textStyle:{color:"#6d6d6d",fontSize:14},data:["微信投票","系统投票","钻石投票","总投票"]},xAxis:[{type:"category",boundaryGap:!1,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{margin:15,textStyle:{fontSize:12,color:"#9933FF"}},data:t}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{margin:10,textStyle:{fontSize:12,color:"#9933FF"}},splitLine:{lineStyle:{color:"#e0e0e0",type:"dotted"}}}],series:[{name:"微信投票",type:"line",smooth:!0,symbol:"circle",symbolSize:5,showSymbol:!1,data:e[0]},{name:"系统投票",type:"line",smooth:!0,symbol:"circle",symbolSize:5,showSymbol:!1,data:e[1]},{name:"钻石投票",type:"line",smooth:!0,symbol:"circle",symbolSize:5,showSymbol:!1,data:e[2]},{name:"总投票",type:"line",smooth:!0,symbol:"circle",symbolSize:5,showSymbol:!1,data:e[3]}]};a.chart=o["a"].init(a.container),a.chart.setOption(i)},doBack:function(){var t=this;t.$router.back()}}},l=s,d=(a("3982"),a("6691")),u=Object(d["a"])(l,i,n,!1,null,null,null);e["default"]=u.exports}}]);