(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ed2b8ea"],{a42d:function(e,t,a){},c84b:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page detail-page"},[a("div",{staticClass:"wrap"},[0==e.actTime.type?a("div",{staticClass:"act-time"},[e._v("活动时间: "+e._s(e.actTime.time))]):e._e(),1==e.actTime.type?a("div",{staticClass:"act-time"},[e._v("投票时间: "+e._s(e.actTime.time2))]):e._e()]),a("div",{staticClass:"player-name-title"},[e._v("【0"+e._s(e.playerNo)+"号】："+e._s(e.playerName))]),e.playerStatusText?a("div",{staticClass:"player-status"},[e._v("提示："+e._s(e.actClosed?"活动已关闭!":e.playerStatusText))]):e._e(),e.address?a("div",{staticClass:"info-content"},[e._v("商家地址："+e._s(e.address))]):e._e(),a("div",{staticClass:"wrap"},[a("wv-grid",[a("wv-grid-item",{staticClass:"g1"},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("当前票数")]),a("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(e.totalVotes))])]),a("wv-grid-item",{staticClass:"g2"},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("当前排名")]),a("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(e.rank))])]),a("wv-grid-item",{staticClass:"g3"},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("与上一名差票")]),a("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(e.rankGap))])])],1)],1),a("div",{staticClass:"wrap images-wrap"},e._l(e.playerPics,function(e,t){return a("img",{key:t,attrs:{src:e}})}),0),e.introduce?a("div",{staticClass:"info-content",domProps:{innerHTML:e._s(e.introduce)}}):e._e(),a("div",{staticClass:"vote-btn",class:{disabled:!e.canVote,top:e.canReward},style:{transform:"translateX("+e.deltX+"px)"},on:{click:function(t){return e.doVote()}}},[a("i",{staticClass:"ali-icon-dianzan"}),e._v(e._s(e.voteText))]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.canReward,expression:"canReward"}],staticClass:"reawrd-btn",style:{transform:"translateX("+e.deltX+"px)"},on:{click:function(t){return e.doClickRewardBtn()}}},[a("i",{staticClass:"ali-icon-lv_zuanshi"}),e._v("助力打赏")]),a("Preview",{attrs:{"is-show":e.showPreview,list:e.previewList,index:e.previewIndex},on:{"update:isShow":function(t){e.showPreview=t},"update:is-show":function(t){e.showPreview=t}}}),a("div",{ref:"reawrdPop",staticClass:"reward-pop-wrap",on:{click:function(t){return e.doHideRewardPop()}}},[a("div",{on:{click:function(t){return e.doReward(t)}}},[e._v("打赏可加票"),a("br"),e._v("请助我一臂之力~")])])],1)},i=[],r=(a("11ac"),a("7364"),a("cb63")),o=a("f1ed"),n=a("46f1"),d=a("e6c4"),c=a("9dfe"),l={1:"投TA一票",2:"已投票",3:"再投一票",4:"正在投票"},u={name:"Detail",components:{Preview:d["a"]},computed:{actClosed:function(){return"5"==this.$store.state.act.status},actTime:function(){var e=this.$store.state.act,t="yyyy-MM-dd hh:mm",a=Object(o["b"])(e.signUpStartTime,t),s=Object(o["b"])(e.signUpEndTime,t),i=Object(o["b"])(e.voteStartTime,t),r=Object(o["b"])(e.voteEndTime,t);new Date;return i==a&&r==s?{type:0,time:i+" ~ "+r}:{type:1,time1:a+" ~ "+s,time2:i+" ~ "+r}},deltX:function(){var e=this.$store.state.winWidth;return e=e>680?680:e,e/2-75}},data:function(){return{showPreview:!1,previewList:[],previewIndex:0,images:null,playerId:"",playerName:"",playerNo:"",introduce:"",totalVotes:0,address:"",rank:0,rankGap:0,playerStatusText:"",playerPics:[],canVote:!1,disabledVoteText:"",voteText:l["1"],inVote:!1,canReward:!1,disabledRewardText:""}},created:function(){var e=this,t=e.$route.query;e.playerId=t.pId,e.playerId?(e.getPlayerDetail(),e.getRank(),e.getCanReawrd()):(Object(c["Toast"])({message:"链接缺少参数!",type:"text",duration:1e3}),setTimeout(function(){e.$router.back()},1e3))},mounted:function(){var e=this;e.$nextTick(function(){e.$store.commit("switchLoading",!1),document.body.addEventListener("click",e.doHandleClickImage),setTimeout(function(){e.initPreview()},1500)})},methods:{doClickRewardBtn:function(){var e=this;e.canReward?e.doReward():Object(c["Toast"])({message:e.disabledRewardText,type:"text",duration:1e3})},doReward:function(e){var t=this;e&&e.stopPropagation(),t.$router.push({name:"reward",query:{actId:t.$store.state.act.id,pId:t.playerId}})},doHideRewardPop:function(){var e=this,t=e.$refs.reawrdPop;t.classList.remove("active"),setTimeout(function(){t.classList.remove("show")},300)},doShowRewardPop:function(){var e=this,t=e.$refs.reawrdPop;t.classList.add("show"),setTimeout(function(){t.classList.add("active")},300)},getCanReawrd:function(){var e=this;Object(o["e"])()?e.$ajax({url:n["a"].canReward+"".concat(e.$store.state.act.id,"/").concat(e.playerId)}).then(function(t){200==t.code&&(e.canReward=t.data,e.disabledRewardText=t.message)}):(e.canReward=!1,e.disabledRewardText="请在微信中打开链接进行打赏!")},getPlayerDetail:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;t.$ajax({url:n["a"].getActPlayer+t.playerId}).then(function(a){if(200==a.code){var s=a.data;if(t.playerName=s.name,t.playerNo=s.no,t.introduce=s.introduce,t.totalVotes=s.totalVotes,t.address=s.address||"",s.pictures){var i=JSON.parse(s.pictures);t.playerPics=i.map(function(e){return Object(r["b"])(e)})}"0"==s.status?t.playerStatusText="该选手已删除!":"1"==s.status?t.playerStatusText="还需等待管理员的审核!":"3"==s.status?t.playerStatusText="该选手已被管理员禁止投票!":"4"==s.status&&(t.playerStatusText="该选手未通过管理员的审核!");var o=t.$store.state.userId;o?e||t.getCanVote():(t.canVote=!1,t.disabledVoteText="未能识别当前用户!");var n=location,d=t.$store.state.act;t.$emit("share",{name:"detail"+t.playerId,shareConfig:{title:d.title,desc:"我是".concat(t.playerName,"，编号：").concat(t.playerNo,"，正在参加").concat(d.title,",请为我加油！"),link:n.origin+"/client/detail?pId"+t.playerId+"&actId="+d.id,imgUrl:t.playerPics[0]}})}})},getCanVote:function(){var e=this,t=e.$store.state;e.$ajax({url:n["a"].canVote,method:"post",params:{verifyType:"client"},data:{actId:t.act.id,playerId:e.playerId,userId:t.userId}}).then(function(t){if(200==t.code){var a=t.data;a.result?(e.canVote=!0,e.disabledVoteText=""):(e.canVote=!1,e.disabledVoteText=a.message,Object(c["Toast"])({message:a.message,type:"text",duration:1e3}))}})},doVote:function(){var e=this,t=e.$store.state;if(e.inVote)Object(c["Toast"])({message:"正在投票...",type:"text",duration:1e3});else{if(!e.canVote)return t.userId?Object(c["Toast"])({message:e.disabledVoteText,type:"text",duration:1e3}):void(Object(o["e"])()?Object(c["Toast"])({message:"投票系统未能识别您是谁!Sorry!",type:"text",duration:1e3}):Object(c["Toast"])({message:"请在微信中打开链接进行投票!",type:"text",duration:1e3}));e.inVote=!0,e.voteText=l["4"],e.$store.commit("switchLoading",!0),e.$ajax({url:n["a"].vote,method:"post",params:{verifyType:"client"},data:{actId:t.act.id,playerId:e.playerId,userId:t.userId}}).then(function(t){if(200==t.code){e.inVote=!1,e.$store.commit("switchLoading",!1),Object(c["Toast"])({message:t.message,type:"text",duration:1e3});var a=t.data;a.result&&(e.getPlayerDetail(!0),e.getRank(),e.$emit("update")),a.again?(e.voteText=l["3"],e.disabledVoteText=""):(e.voteText=l["2"],e.canVote=!1,e.disabledVoteText=a.againMessage)}})}},getRank:function(){var e=this,t=e.$store;e.$ajax({url:n["a"].getActPlayers+t.state.act.id,params:{pageSize:5e3,page:1,order:"totalVotes",orderDir:"DESC"}}).then(function(t){if(200==t.code){for(var a=t.data,s=0;s<a.dataList.length;s++)if(a.dataList[s].id==e.playerId)break;if(s<a.dataList.length)if(e.rank=s+1,0==s)e.rankGap=0;else{var i=a.dataList[s-1],r=a.dataList[s];e.rankGap=i.totalVotes-r.totalVotes}}})},initPreview:function(){for(var e,t=this,a=document.querySelectorAll("img"),s=[],i=null,r=0;r<a.length;r++){for(i=a[r],e=0;e<s.length;e++)if(s[e]==i.src)break;e==s.length&&s.push(i.src)}0!=s.length&&(t.images=s,t.getImageSize(0))},getImageSize:function(e){var t=this,a=t.images[e],s=new Image;s.onload=function(){t.previewList.push({src:a,w:this.width,h:this.height}),e<t.images.length-1&&t.getImageSize(e+1)},s.src=a},doHandleClickImage:function(e){var t=this,a=e.target;if(!t.showPreview&&/img/i.test(a.tagName)&&"pswp__img"!=a.className){t.previewIndex=0;for(var s=0;s<t.previewList.length;s++)if(t.previewList[s].src==a.src){t.previewIndex=s;break}t.showPreview=!0}}},beforeDestroy:function(){var e=this;document.body.removeEventListener("click",e.doHandleClickImage)}},p=u,v=(a("ed23"),a("6691")),m=Object(v["a"])(p,s,i,!1,null,null,null);t["default"]=m.exports},ed23:function(e,t,a){"use strict";var s=a("a42d"),i=a.n(s);i.a}}]);