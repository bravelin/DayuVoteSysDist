(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33547ba8"],{2442:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page reawrd-page"},[a("div",{staticClass:"wrap",staticStyle:{display:"none"}},[0==t.actTime.type?a("div",{staticClass:"act-time"},[t._v("活动时间: "+t._s(t.actTime.time))]):t._e(),1==t.actTime.type?a("div",{staticClass:"act-time"},[t._v("投票时间: "+t._s(t.actTime.time2))]):t._e()]),t.logo?a("div",{staticClass:"player-logo",style:{"background-image":"url("+t.logo+")"}}):t._e(),a("div",{staticClass:"player-name-title"},[t._v("【0"+t._s(t.playerNo)+"号】："+t._s(t.playerName))]),t.playerStatusText?a("div",{staticClass:"player-status"},[t._v("提示："+t._s(t.actClosed?"活动已关闭!":t.playerStatusText))]):t._e(),a("div",{staticClass:"wrap"},[a("wv-grid",[a("wv-grid-item",{staticClass:"g1"},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("当前票数")]),a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.totalVotes))])]),a("wv-grid-item",{staticClass:"g2"},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("当前排名")]),a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.rank))])]),a("wv-grid-item",{staticClass:"g3"},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("与上一名差票")]),a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.rankGap))])])],1)],1),a("div",{staticClass:"wrap"},[a("div",{staticClass:"tip-info"},[t._v("请选择赠送的钻石票数（"),a("span",[t._v("1元 = "+t._s(t.rewardRatio)+"票")]),t._v("）：")]),a("ul",{staticClass:"diamond-list"},t._l(t.reawrdList,(function(e){return a("li",{key:e.value,staticClass:"diamond ali-icon-lv_zuanshi",class:{active:t.selectedDiamond===e.value},on:{click:function(a){return t.doSelect(e)}}},[t._v(t._s(e.label)),e.value?a("span",[t._v("票")]):t._e()])})),0)]),a("div",{staticClass:"footer",style:{width:t.winWidth+"px"}},[a("div",{staticClass:"ali-icon-home",on:{click:function(e){return t.toHome()}}},[t._v("首页")]),a("div",{staticClass:"ali-icon-jinggao",staticStyle:{display:"none"},on:{click:function(e){return t.toAdvise()}}},[t._v("投诉")]),a("wv-button",{attrs:{type:"primary",disabled:!t.selectedDiamond},on:{click:function(e){return t.doReward()}}},[t._v("微信支付"),a("span",{directives:[{name:"show",rawName:"v-show",value:t.selectedDiamond,expression:"selectedDiamond"}]},[a("b",[t._v(t._s(t.selectedDiamond))]),t._v("元")])])],1),a("div",{ref:"selfPop",staticClass:"self-define-pop",on:{click:function(e){return t.hideSelfDefinePop()}}},[a("div",{on:{click:function(e){return t.doClickSelfDefineWrap(e)}}},[a("h3",[t._v("自定义打赏金额")]),a("div",{staticClass:"pop-item"},[a("label",[t._v("打赏金额：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.selfInput,expression:"selfInput"}],attrs:{placeholder:"请输入小于5000的正整数",type:"number",maxlength:"5"},domProps:{value:t.selfInput},on:{input:function(e){e.target.composing||(t.selfInput=e.target.value)}}})]),a("div",{staticClass:"pop-item"},[a("label",[t._v("钻石票数：")]),a("span",[t._v(t._s(t.selfDiamondNum))])]),a("div",{staticClass:"button-wrap"},[a("wv-button",{attrs:{type:"primary",disabled:!t.selfInputValid},on:{click:function(e){return t.doReward()}}},[t._v("微信支付")])],1)])])])},i=[],n=(a("7364"),a("11ac"),a("7bc1"),a("a7be"),a("e836"),a("cb63")),r=a("f1ed"),o=a("46f1"),l=a("29a3"),c={name:"Reward",computed:{selfDiamondNum:function(){var t=this;return/^[1-9]\d*$/.test(t.selfInput)?t.rewardRatio*(t.selfInput-0):""},selfInputValid:function(){return/^[1-9]\d*$/.test(this.selfInput)},winWidth:function(){var t=this.$store.state.winWidth;return t>680&&(t=680),t},actClosed:function(){return"5"==this.$store.state.act.status},actTime:function(){var t=this.$store.state.act,e="yyyy-MM-dd hh:mm",a=Object(r["c"])(t.signUpStartTime,e),s=Object(r["c"])(t.signUpEndTime,e),i=Object(r["c"])(t.voteStartTime,e),n=Object(r["c"])(t.voteEndTime,e);new Date;return i==a&&n==s?{type:0,time:i+" ~ "+n}:{type:1,time1:a+" ~ "+s,time2:i+" ~ "+n}}},data:function(){return{playerId:"",playerName:"",playerNo:"",totalVotes:0,rewardRatio:3,address:"",rank:0,logo:"",rankGap:0,playerStatusText:"",canReward:!1,disabledRewardText:"",reawrdList:[],selectedDiamond:"",selfInput:"",inPay:!1}},created:function(){var t=this,e=t.$route.query;t.playerId=e.pId,t.playerId?(t.getPlayerDetail(),t.getRank(),t.getReawrdList(),Object(r["f"])()?t.getCanReawrd():(t.canReward=!1,Object(l["Toast"])({message:"请在微信中打开链接进行打赏!",type:"text",duration:1e3})),setTimeout((function(){t.$emit("checkstatus")}),2e3)):(Object(l["Toast"])({message:"链接缺少参数!",type:"text",duration:1e3}),setTimeout((function(){t.$router.back()}),1e3))},methods:{doReward:function(){var t=this;if(t.inPay)return Object(l["Toast"])({message:"正在支付中...",type:"text",duration:1e3});if(!t.canReward)return Object(l["Toast"])({message:t.disabledRewardText,type:"text",duration:1e3});var e=0;if(t.selectedDiamond)e=t.selectedDiamond-0;else{var a=t.selfInput.trim();if(""==a)return Object(l["Toast"])({message:"请输入小于5000的正整数",type:"text",duration:1e3});if(!/^[1-9]\d*$/.test(a))return Object(l["Toast"])({message:"您的输入不正确!",type:"text",duration:1e3});if(a-0>5e3)return Object(l["Toast"])({message:"输入值不能大于5000!",type:"text",duration:1e3});e=a-0}var s=parseInt(100*e),i=t.$store.state;t.inPay=!0,t.$ajax({url:o["a"].doPrePay,method:"POST",params:{verifyType:"client"},data:{openId:i.userOpenId,userId:i.userId,playerId:t.playerId,totalFee:s}}).then((function(e){200!=e.code?Object(l["Toast"])({message:e.message,type:"text",duration:1e3}):t.doInvokeWxPay(e.data)}))},doInvokeWxPay:function(t){var e=this,a={appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign};Object(r["h"])((function(){WeixinJSBridge.invoke("getBrandWCPayRequest",a,(function(a){e.inPay=!1,a.err_msg&&a.err_msg.indexOf("ok")>=0?e.paySuccess():(Object(l["Toast"])({message:"未能成功支付！",type:"text",duration:1e3}),e.$ajax({url:o["a"].cancelOrder,method:"POST",params:{verifyType:"client"},data:{id:t.orderId}}))}))}))},paySuccess:function(){var t=this;setTimeout((function(){t.$router.push({name:"success",query:{actId:t.$store.state.act.id,pId:t.playerId,pNo:t.playerNo}})}),0)},doSelect:function(t){var e=this;e.selectedDiamond=t.value,0==t.value&&e.showSelfDefinePop()},getReawrdList:function(){var t=this;t.$ajax({url:o["a"].getRewardList}).then((function(e){if(200==e.code){var a=e.data,s=a.rewardList.split(",");t.rewardRatio=a.rewardRatio-0,t.reawrdList=s.map((function(e){return 0!=e?{label:e*t.rewardRatio,value:e-0}:{label:"自定义",value:0}}))}}))},getCanReawrd:function(){var t=this;t.$ajax({url:o["a"].canReward+"".concat(t.$store.state.act.id,"/").concat(t.playerId)}).then((function(e){200==e.code&&(t.canReward=e.data,t.disabledRewardText=e.message)}))},getPlayerDetail:function(){var t=this;t.$ajax({url:o["a"].getActPlayer+t.playerId}).then((function(e){if(200==e.code){var a=e.data;t.playerName=a.name,t.playerNo=a.no,t.totalVotes=a.totalVotes;var s=[];if(a.pictures){var i=JSON.parse(a.pictures);s=i.map((function(t){return Object(n["b"])(t)})),t.logo=s[0]}"0"==a.status?t.playerStatusText="该选手已删除!":"1"==a.status?t.playerStatusText="还需等待管理员的审核!":"3"==a.status?t.playerStatusText="该选手已被管理员禁止投票!":"4"==a.status&&(t.playerStatusText="该选手未通过管理员的审核!");var r=t.$store.state.userId;r||(t.canReward=!1,t.disabledRewardText="未能识别当前用户!");var o=location,l=t.$store.state.act;t.$emit("share",{name:"detail"+t.playerId,shareConfig:{title:l.title,desc:"我是".concat(t.playerName,"，编号：").concat(t.playerNo,"，正在参加").concat(l.title,",请为我加油！"),link:o.origin+"/client/detail?pId"+t.playerId+"&actId="+l.id,imgUrl:s[0]}})}t.$store.commit("switchLoading",!1)}))},getRank:function(){var t=this,e=t.$store;t.$ajax({url:o["a"].getActPlayers+e.state.act.id,params:{pageSize:5e3,page:1,order:"totalVotes",orderDir:"DESC"}}).then((function(e){if(200==e.code){for(var a=e.data,s=0;s<a.dataList.length;s++)if(a.dataList[s].id==t.playerId)break;if(s<a.dataList.length)if(t.rank=s+1,0==s)t.rankGap=0;else{var i=a.dataList[s-1],n=a.dataList[s];t.rankGap=i.totalVotes-n.totalVotes}}}))},toHome:function(){var t=this,e=t.$store.state.act.id;t.$router.push({name:"home",query:{actId:e}})},toAdvise:function(){var t=this,e=t.$store.state.act.id;t.$router.push({name:"advise",query:{actId:e}})},doClickSelfDefineWrap:function(t){t.stopPropagation()},showSelfDefinePop:function(){var t=this,e=t.$refs.selfPop;t.selfInput="",e.classList.add("show"),setTimeout((function(){e.classList.add("active")}),300)},hideSelfDefinePop:function(){var t=this,e=t.$refs.selfPop;e.classList.remove("active"),setTimeout((function(){e.classList.remove("show")}),300)}}},d=c,u=(a("ae02"),a("6691")),p=Object(u["a"])(d,s,i,!1,null,null,null);e["default"]=p.exports},"539d":function(t,e,a){var s=a("b2f5"),i=a("f01a"),n=a("b6f1"),r=a("c9ea"),o="["+r+"]",l="​",c=RegExp("^"+o+o+"*"),d=RegExp(o+o+"*$"),u=function(t,e,a){var i={},o=n((function(){return!!r[t]()||l[t]()!=l})),c=i[t]=o?e(p):r[t];a&&(i[a]=c),s(s.P+s.F*o,"String",i)},p=u.trim=function(t,e){return t=String(i(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(d,"")),t};t.exports=u},a7be:function(t,e,a){"use strict";var s=a("b2f5"),i=a("9f58")(!1),n=[].indexOf,r=!!n&&1/[1].indexOf(1,-0)<0;s(s.P+s.F*(r||!a("119c")(n)),"Array",{indexOf:function(t){return r?n.apply(this,arguments)||0:i(this,t,arguments[1])}})},ae02:function(t,e,a){"use strict";var s=a("c8ea"),i=a.n(s);i.a},c8ea:function(t,e,a){},c9ea:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},e836:function(t,e,a){"use strict";a("539d")("trim",(function(t){return function(){return t(this,3)}}))}}]);