(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c4172fa"],{"1c4f":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page sign-page"},[i("div",{staticClass:"wrap",staticStyle:{display:"none"}},[0==t.actTime.type?i("div",{staticClass:"act-time"},[t._v("活动时间："+t._s(t.actTime.time))]):t._e(),1==t.actTime.type?i("div",{staticClass:"act-time"},[t._v("报名时间："+t._s(t.actTime.time1))]):t._e(),1==t.actTime.type?i("div",{staticClass:"act-time"},[t._v("投票时间："+t._s(t.actTime.time2))]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:4==t.actStatus&&5==t.actStatus,expression:"actStatus==4 && actStatus==5"}],staticClass:"act-status"},[t._v("抱歉,"+t._s("4"==t.actStatus?"活动已结束!":"5"==t.actStatus?"活动已关闭!":"活动未进行!"))])]),i("div",{staticClass:"select-pic-tip"},[t._v("选择上传1-5张照片，第一张为封面图。")]),i("el-upload",{ref:"upload",staticClass:"pic-list",class:{disabled:!t.actTime.canSign||!t.canSign||t.actClosed},attrs:{disabled:!t.actTime.canSign,"file-list":t.form.pictures,action:t.uploadAction,"list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handlePictureRemove,"on-success":t.handlePictureUploadSuccess,limit:12}},[i("i",{staticClass:"el-icon-plus"})]),i("wv-group",{staticClass:"form-group",class:{disabled:!t.actTime.canSign||!t.canSign||t.actClosed}},[i("wv-input",{attrs:{readonly:!t.actTime.canSign||!t.canSign||t.actClosed,label:"姓名：",placeholder:"请输入姓名",labelWidth:90,maxlength:50,required:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),i("wv-input",{attrs:{readonly:!t.actTime.canSign||!t.canSign||t.actClosed,label:"手机号码：",placeholder:"请输入手机号码",labelWidth:90,maxlength:20,required:""},model:{value:t.form.tel,callback:function(e){t.$set(t.form,"tel",e)},expression:"form.tel"}}),i("wv-textarea",{staticClass:"introduce",attrs:{disabled:!t.actTime.canSign||!t.canSign||t.actClosed,placeholder:"请输入参赛宣言",rows:3,"max-length":500,"show-counter":!0,required:""},model:{value:t.form.introduce,callback:function(e){t.$set(t.form,"introduce",e)},expression:"form.introduce"}})],1),i("div",{staticClass:"commit-tip"},[t._v("请如实填写报名信息，提交信息为唯一获奖凭证。")]),i("div",{staticClass:"wrap"},[i("wv-button",{attrs:{disabled:!t.actTime.canSign||!t.canSign||t.actClosed,type:"primary"},on:{click:function(e){return t.doCommit()}}},[t._v("提交报名")])],1),i("Preview",{attrs:{"is-show":t.showPreview,list:t.previewList,index:t.previewIndex},on:{"update:isShow":function(e){t.showPreview=e},"update:is-show":function(e){t.showPreview=e}}})],1)},n=[],s=(i("608b"),i("e836"),i("7364"),i("11ac"),i("f1ed")),c=i("46f1"),r=i("e6c4"),o=i("9dfe"),u={name:"Sign",components:{Preview:r["a"]},computed:{winHeight:function(){return this.$store.state.winHeight},actStatus:function(){return this.$store.state.act.status},actClosed:function(){return"5"==this.$store.state.act.status},actTime:function(){var t=this.$store.state.act,e="yyyy-MM-dd hh:mm",i=Object(s["c"])(t.signUpStartTime,e),a=Object(s["c"])(t.signUpEndTime,e),n=Object(s["c"])(t.voteStartTime,e),c=Object(s["c"])(t.voteEndTime,e),r=new Date,o=r.getTime()>t.signUpStartTime.getTime()&&r.getTime()<t.signUpEndTime.getTime();return n==i&&c==a?{type:0,time:n+" ~ "+c,canSign:o}:{type:1,time1:i+" ~ "+a,time2:n+" ~ "+c,canSign:o}}},data:function(){return{form:{name:"",tel:"",introduce:"",pictures:[]},showPreview:!1,previewList:[],previewIndex:0,uploadAction:"/api/ue",canSign:!0}},created:function(){var t=this,e=t.$store.state;t.$store.commit("switchLoading",!1),t.uploadAction="/api/ue?verifyType=client&action=uploadimage&_csrf=".concat(Object(s["a"])("csrfToken"),"&uid=").concat(e.userId,"&Authorization=Bearer ").concat(e.userToken),Object(s["f"])()?(t.$ajax({url:c["a"].isSigned,method:"post",params:{verifyType:"client"},data:{actId:e.act.id}}).then(function(e){200==e.code&&(t.canSign=!e.data,t.canSign||Object(o["Toast"])({message:"您已经报过名了!",type:"text",duration:3e3}))}),setTimeout(function(){t.$emit("share",{name:"global"})},1e3)):(t.canSign=!1,Object(o["Toast"])({message:"请您在微信中打开链接进行报名!",type:"text",duration:3e3}))},methods:{doCommit:function(){var t=this;if(t.canSign&&t.actTime.canSign&&t.doCheck()){t.$store.commit("switchLoading",!0);var e=t.form,i=t.$store.state,a=e.pictures.map(function(t){return t.realUrl}),n={actId:i.act.id,name:e.name,tel:e.tel,remark:"",type:"1",introduce:e.introduce,pictures:JSON.stringify(a)};t.$ajax({url:c["a"].sign,method:"POST",params:{verifyType:"client"},data:n}).then(function(e){200==e.code?(t.$emit("update"),Object(o["Toast"])({message:"报名成功!",type:"text",duration:1e3}),setTimeout(function(){t.$router.push({name:"detail",query:{actId:i.act.id,pId:e.data.id}})},500)):Object(o["Toast"])({message:"报名失败!",type:"text",duration:1e3}),t.$store.commit("switchLoading",!1)})}},doCheck:function(){var t=this,e=t.form,i=e.name.trim();if(!i)return Object(o["Toast"])({message:"请输入名称!",type:"text",duration:1e3}),!1;e.name=i;var a=e.tel.trim();if(!a)return Object(o["Toast"])({message:"请输入联系电话!",type:"text",duration:1e3}),!1;e.tel=a;var n=e.introduce.trim();return n?(e.introduce=n,0!=e.pictures.length||(Object(o["Toast"])({message:"请上传介绍图片!",type:"text",duration:1e3}),!1)):(Object(o["Toast"])({message:"请输入介绍!",type:"text",duration:1e3}),!1)},handlePictureCardPreview:function(t){var e=this;e.previewIndex=0;for(var i=0;i<e.previewList.length;i++)if(e.previewList[i].src==t.url){e.previewIndex=i;break}e.showPreview=!0},getImageSize:function(t){var e=this,i=e.form.pictures[t],a=new Image;a.onload=function(){e.previewList.push({src:i.url,w:this.width,h:this.height}),t<e.form.pictures.length-1&&e.getImageSize(t+1)},a.src=i.url},handlePictureUploadSuccess:function(t,e,i){var a=this;e.realUrl=t.url,a.form.pictures=i;var n=new Image;n.onload=function(){a.previewList.push({src:n.src,w:this.width,h:this.height})},n.src=e.url},handlePictureRemove:function(t,e){var i=this;i.form.pictures=e;var a=i.previewList.find(function(e){return e.url==t.url});a&&i.previewList.splice(a,1)}}},d=u,l=(i("da4b"),i("6691")),m=Object(l["a"])(d,a,n,!1,null,null,null);e["default"]=m.exports},"54c6":function(t,e,i){},"608b":function(t,e,i){"use strict";var a=i("b2f5"),n=i("2d43")(5),s="find",c=!0;s in[]&&Array(1)[s](function(){c=!1}),a(a.P+a.F*c,"Array",{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i("644a")(s)},da4b:function(t,e,i){"use strict";var a=i("54c6"),n=i.n(a);n.a},e836:function(t,e,i){"use strict";i("539d")("trim",function(t){return function(){return t(this,3)}})}}]);